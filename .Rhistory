tab5_boxplot <- tab5_boxplot %>%
mutate(city_country_label = paste0(city, "\n", country))
ggplot(tab5_boxplot, aes(x = city_country_label, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
position = position_dodge(width = 0.8) # Side-by-side box plots
) +
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City and Country",
y = "Price (per kg)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 0, hjust = 0.5),  # Center-align labels
axis.title.x = element_text(size = 12, margin = margin(t = 10)), # Add margin
legend.position = "bottom"                                        # Legend at bottom
)
# CREATE A BOXPLOT
# Create table in correct data format
tab5_boxplot <- tab5_city_data %>%
# Calculate Q1 and Q3
mutate(
q1_org_rice = median_org_rice - (iqr_org_rice / 2),
q3_org_rice = median_org_rice + (iqr_org_rice / 2),
q1_conv_rice = median_conv_rice - (iqr_conv_rice / 2),
q3_conv_rice = median_conv_rice + (iqr_conv_rice / 2),
) %>%
# Select necessary columns
select(
country, city,
min_org_rice, q1_org_rice, median_org_rice, q3_org_rice, max_org_rice,
min_conv_rice, q1_conv_rice, median_conv_rice, q3_conv_rice, max_conv_rice
) %>%
# Reshape into long format
pivot_longer(
cols = c(min_org_rice, q1_org_rice, median_org_rice, q3_org_rice, max_org_rice,
min_conv_rice, q1_conv_rice, median_conv_rice, q3_conv_rice, max_conv_rice), # Include all relevant columns
names_to = c(".value", "Type"),                # Separate names into '.value' (metrics) and 'Type'
names_pattern = "(.*)_(org|conv)"              # Pattern: metric_(org|conv)
)
# Create boxplot
ggplot(tab5_boxplot, aes(x = city, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
position = position_dodge2(padding = 0.3) # Dodge to avoid overlapping between cities
) +
facet_wrap(~ country, scales = "free_x") + # Separate panels by country
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1), # Rotated x-axis labels
strip.text = element_text(size = 12, face = "bold"), # Facet titles
legend.position = "bottom", # Move legend to the bottom
legend.title = element_blank() # Remove legend title
)
# Create boxplot
ggplot(tab5_boxplot, aes(x = city, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
position = position_dodge2(padding = 0.3) # Dodge to avoid overlapping between cities
) +
facet_wrap(~ country, scales = "free_x") + # Separate panels by country
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg, USD)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1), # Rotated x-axis labels
strip.text = element_text(size = 12, face = "bold"), # Facet titles
legend.position = "bottom", # Move legend to the bottom
legend.title = element_blank() # Remove legend title
)
# Load necessary libraries
library(dplyr)
library(gmodels)
library(gt)
library(knitr)
library(kableExtra)
library(openxlsx)
library(readxl)
library(readr)
library(stats)
library(tidyr)
library(ggplot2)
knitr::opts_chunk$set(echo = TRUE)
# Set working directory
#setwd("C:/Users/s1985751/Documents/GitHub/fea")
# Load cleaned data
data_clean <- read.xlsx("data_clean.xlsx", sheet = "data")
# Create workbook for table data
table_outputs <- createWorkbook()
saveWorkbook(table_outputs, "Outputs/table_outputs.xlsx", overwrite = TRUE)
# Calculate number of organic and conventional vendors, median, IQR, min and max price
tab5_city_data <- rice_prices_data %>%
group_by(country, city) %>%
summarise(
count_org_rice_vendors = sum(!is.na(rice_price_org_kg_usd)),
count_conv_rice_vendors = sum(!is.na(rice_price_conv_kg_usd)),
median_org_rice = median(rice_price_org_kg_usd, na.rm = TRUE),
iqr_org_rice = IQR(rice_price_org_kg_usd, na.rm = TRUE),
min_org_rice = min(rice_price_org_kg_usd, na.rm = TRUE),
max_org_rice = max(rice_price_org_kg_usd, na.rm = TRUE),
median_conv_rice = median(rice_price_conv_kg_usd, na.rm = TRUE),
iqr_conv_rice = IQR(rice_price_conv_kg_usd, na.rm = TRUE),
min_conv_rice = min(rice_price_conv_kg_usd, na.rm = TRUE),
max_conv_rice = max(rice_price_conv_kg_usd, na.rm = TRUE),
) %>%
ungroup()
# Load cleaned rice prices data
rice_prices_data <- read.xlsx("rice_prices_data_clean.xlsx", sheet = "data")
# Calculate number of organic and conventional vendors, median, IQR, min and max price
tab5_city_data <- rice_prices_data %>%
group_by(country, city) %>%
summarise(
count_org_rice_vendors = sum(!is.na(rice_price_org_kg_usd)),
count_conv_rice_vendors = sum(!is.na(rice_price_conv_kg_usd)),
median_org_rice = median(rice_price_org_kg_usd, na.rm = TRUE),
iqr_org_rice = IQR(rice_price_org_kg_usd, na.rm = TRUE),
min_org_rice = min(rice_price_org_kg_usd, na.rm = TRUE),
max_org_rice = max(rice_price_org_kg_usd, na.rm = TRUE),
median_conv_rice = median(rice_price_conv_kg_usd, na.rm = TRUE),
iqr_conv_rice = IQR(rice_price_conv_kg_usd, na.rm = TRUE),
min_conv_rice = min(rice_price_conv_kg_usd, na.rm = TRUE),
max_conv_rice = max(rice_price_conv_kg_usd, na.rm = TRUE),
) %>%
ungroup()
# Create the gt table
tab5_city <- tab5_city_data %>%
gt(rowname_col = "city", groupname_col = c("country")) %>%
cols_label(
country = "Country",
city = "City",
count_org_rice_vendors = "Organic sample size (n)",
count_conv_rice_vendors = "Conventional sample size (n)",
median_org_rice = "Organic median (IQR), min-max (US$)",
iqr_org_rice = " ",
min_org_rice = " ",
max_org_rice = " ",
median_conv_rice = "Conventional median (IQR), min-max (US$)",
iqr_conv_rice = " ",
min_conv_rice = " ",
max_conv_rice = " "
) %>%
cols_merge(
columns = c("median_org_rice", "iqr_org_rice", "min_org_rice", "max_org_rice"),
pattern = "{1} ({2}), {3}-{4}"
) %>%
cols_merge(
columns = c("median_conv_rice", "iqr_conv_rice", "min_conv_rice", "max_conv_rice"),
pattern = "{1} ({2}), {3}-{4}"
) %>%
fmt_number(
columns = vars(median_org_rice, iqr_org_rice, min_org_rice, max_org_rice,
median_conv_rice, iqr_conv_rice, min_conv_rice, max_conv_rice),
decimals = 2
) %>%
summary_rows(
groups = everything(),
columns = vars(count_org_rice_vendors,count_conv_rice_vendors),
fns = list(total = ~sum(., na.rm = TRUE)),
formatter = fmt_number,
decimals = 0,
) %>%
sub_missing()
# Display the table
tab5_city
# CREATE A BOXPLOT
# Create table in correct data format
tab5_boxplot <- tab5_city_data %>%
# Calculate Q1 and Q3
mutate(
q1_org_rice = median_org_rice - (iqr_org_rice / 2),
q3_org_rice = median_org_rice + (iqr_org_rice / 2),
q1_conv_rice = median_conv_rice - (iqr_conv_rice / 2),
q3_conv_rice = median_conv_rice + (iqr_conv_rice / 2),
) %>%
# Select necessary columns
select(
country, city,
min_org_rice, q1_org_rice, median_org_rice, q3_org_rice, max_org_rice,
min_conv_rice, q1_conv_rice, median_conv_rice, q3_conv_rice, max_conv_rice
) %>%
# Reshape into long format
pivot_longer(
cols = c(min_org_rice, q1_org_rice, median_org_rice, q3_org_rice, max_org_rice,
min_conv_rice, q1_conv_rice, median_conv_rice, q3_conv_rice, max_conv_rice), # Include all relevant columns
names_to = c(".value", "Type"),                # Separate names into '.value' (metrics) and 'Type'
names_pattern = "(.*)_(org|conv)"              # Pattern: metric_(org|conv)
)
# Create boxplot
ggplot(tab5_boxplot, aes(x = city, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
position = position_dodge(width = 0.8)
#position = position_dodge2(padding = 0.3) # Dodge to avoid overlapping between cities
) +
facet_wrap(~ country, scales = "free_x") + # Separate panels by country
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg, USD)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
scale_x_discrete(
expand = expansion(add = 0.5) # Add padding to ensure gridlines align with city boundaries
) +
theme_minimal() +
theme(
panel.grid.major.x = element_line(color = "gray", size = 0.5), # Adjust gridlines
panel.grid.minor.x = element_blank(),                         # Remove minor gridlines
axis.text.x = element_text(angle = 45, hjust = 1), # Rotated x-axis labels
strip.text = element_text(size = 12, face = "bold"), # Facet titles
legend.position = "bottom", # Move legend to the bottom
legend.title = element_blank() # Remove legend title
)
# need to extend the y-axis for visibility
# Export to table_outputs workbook
addWorksheet(table_outputs, "Table 5 - city")
writeData(table_outputs, sheet = "Table 5 - city", x = tab5_city)
saveWorkbook(table_outputs, "C:/Users/s1985751/Documents/GitHub/fea/table_outputs.xlsx", overwrite = TRUE)
# Add a buffer column between each city and group by country
tab5_boxplot <- tab5_boxplot %>%
mutate(city_with_country = paste0(city, "\n(", country, ")")) # Add country under city names
ggplot(tab5_boxplot, aes(x = city_with_country, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
position = position_dodge(width = 0.8) # Avoid overlap
) +
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg, USD)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
scale_x_discrete(
expand = expansion(mult = c(0.05, 0.05)) # Add padding between cities
) +
theme_minimal() +
theme(
panel.grid.major.x = element_line(color = "gray", size = 0.5), # Vertical gridlines for clarity
panel.grid.minor.x = element_blank(),                         # Remove minor x gridlines
axis.text.x = element_text(angle = 45, hjust = 1),            # Rotate x-axis text
strip.text = element_text(size = 12, face = "bold"),          # Bold country labels
legend.position = "bottom"                                    # Legend at the bottom
)
# CREATE A BOXPLOT
# Create table in correct data format
tab5_boxplot <- tab5_city_data %>%
# Calculate Q1 and Q3
mutate(
q1_org_rice = median_org_rice - (iqr_org_rice / 2),
q3_org_rice = median_org_rice + (iqr_org_rice / 2),
q1_conv_rice = median_conv_rice - (iqr_conv_rice / 2),
q3_conv_rice = median_conv_rice + (iqr_conv_rice / 2),
) %>%
# Select necessary columns
select(
country, city,
min_org_rice, q1_org_rice, median_org_rice, q3_org_rice, max_org_rice,
min_conv_rice, q1_conv_rice, median_conv_rice, q3_conv_rice, max_conv_rice
) %>%
# Reshape into long format
pivot_longer(
cols = c(min_org_rice, q1_org_rice, median_org_rice, q3_org_rice, max_org_rice,
min_conv_rice, q1_conv_rice, median_conv_rice, q3_conv_rice, max_conv_rice), # Include all relevant columns
names_to = c(".value", "Type"),                # Separate names into '.value' (metrics) and 'Type'
names_pattern = "(.*)_(org|conv)"              # Pattern: metric_(org|conv)
)
# Create boxplot
ggplot(tab5_boxplot, aes(x = city, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
position = position_dodge(width = 0.8)
#position = position_dodge2(padding = 0.3) # Dodge to avoid overlapping between cities
) +
facet_wrap(~ country, scales = "free_x") + # Separate panels by country
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg, USD)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
scale_x_discrete(
expand = expansion(add = 0.5) # Add padding to ensure gridlines align with city boundaries
) +
theme_minimal() +
theme(
panel.grid.major.x = element_line(color = "gray", size = 0.5), # Adjust gridlines
panel.grid.minor.x = element_blank(),                         # Remove minor gridlines
axis.text.x = element_text(angle = 45, hjust = 1), # Rotated x-axis labels
strip.text = element_text(size = 12, face = "bold"), # Facet titles
legend.position = "bottom", # Move legend to the bottom
legend.title = element_blank() # Remove legend title
)
# Create boxplot
ggplot(tab5_boxplot, aes(x = city, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
position = position_dodge(width = 0.8)
#position = position_dodge2(padding = 0.3) # Dodge to avoid overlapping between cities
) +
facet_wrap(~ country, scales = "free_x") + # Separate panels by country
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg, USD)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
scale_x_discrete(
expand = expansion(add = 0.5) # Add padding to ensure gridlines align with city boundaries
) +
scale_y_continuous(
limits = c(0, 15),      # Extend the y-axis from 0 to 15 (adjust as needed)
expand = expansion(mult = c(0, 0.05)) # Add a small padding above the largest value
) +
theme_minimal() +
theme(
panel.grid.major.x = element_line(color = "gray", size = 0.5), # Adjust gridlines
panel.grid.minor.x = element_blank(),                         # Remove minor gridlines
axis.text.x = element_text(angle = 45, hjust = 1), # Rotated x-axis labels
strip.text = element_text(size = 12, face = "bold"), # Facet titles
legend.position = "bottom", # Move legend to the bottom
legend.title = element_blank() # Remove legend title
)
# Create boxplot
ggplot(tab5_boxplot, aes(x = city, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
position = position_dodge(width = 0.8)
#position = position_dodge2(padding = 0.3) # Dodge to avoid overlapping between cities
) +
facet_wrap(~ country, scales = "free_x") + # Separate panels by country
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg, USD)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
scale_x_discrete(
expand = expansion(add = 0.5) # Add padding to ensure gridlines align with city boundaries
) +
theme_minimal() +
theme(
panel.grid.major.x = element_line(color = "gray", size = 0.5), # Adjust gridlines
panel.grid.minor.x = element_blank(),                         # Remove minor gridlines
axis.text.x = element_text(angle = 45, hjust = 1), # Rotated x-axis labels
strip.text = element_text(size = 12, face = "bold"), # Facet titles
legend.position = "bottom", # Move legend to the bottom
legend.title = element_blank() # Remove legend title
)
# Create boxplot
ggplot(tab5_boxplot, aes(x = city, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
#position = position_dodge(width = 0.8)
position = position_dodge2(padding = 0.3) # Dodge to avoid overlapping between cities
) +
facet_wrap(~ country, scales = "free_x") + # Separate panels by country
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg, USD)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
scale_x_discrete(
expand = expansion(add = 0.5) # Add padding to ensure gridlines align with city boundaries
) +
theme_minimal() +
theme(
panel.grid.major.x = element_line(color = "gray", size = 0.5), # Adjust gridlines
panel.grid.minor.x = element_blank(),                         # Remove minor gridlines
axis.text.x = element_text(angle = 45, hjust = 1), # Rotated x-axis labels
strip.text = element_text(size = 12, face = "bold"), # Facet titles
legend.position = "bottom", # Move legend to the bottom
legend.title = element_blank() # Remove legend title
)
# Create boxplot
ggplot(tab5_boxplot, aes(x = city, fill = Type)) +
geom_boxplot(
aes(
ymin = min,
lower = q1,
middle = median,
upper = q3,
ymax = max
),
stat = "identity",
#position = position_dodge(width = 0.8)
position = position_dodge2(padding = 0.3) # Dodge to avoid overlapping between cities
) +
facet_wrap(~ country, scales = "free_x") + # Separate panels by country
labs(
title = "Box Plot of Organic vs Conventional Rice Prices",
x = "City",
y = "Price (per kg, USD)"
) +
scale_fill_manual(
values = c("org" = "skyblue", "conv" = "lightgreen"),
labels = c("Organic", "Conventional")
) +
scale_x_discrete(
expand = expansion(add = 0.5) # Add padding to ensure gridlines align with city boundaries
) +
theme_light() +
theme(
panel.grid.major.x = element_line(color = "gray", size = 0.5), # Adjust gridlines
panel.grid.minor.x = element_blank(),                         # Remove minor gridlines
axis.text.x = element_text(angle = 45, hjust = 1), # Rotated x-axis labels
strip.text = element_text(size = 12, face = "bold"), # Facet titles
legend.position = "bottom", # Move legend to the bottom
legend.title = element_blank() # Remove legend title
)
